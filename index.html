<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Just+Another+Hand&display=swap" rel="stylesheet">
    <title>MultiUserSketch by Abi</title>
    <style>
        body {
            text-align: center;
            width: 100vw;
            font-family: 'Just Another Hand', cursive;
            overflow-x: hidden;
            overflow-y: hidden;
        }

        #board {
            width: 100vw;
            height: 100vw;
            background-color: #000;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(64, 1fr);
            gap: 0;

        }

        #board div {

            background-color: #fff;
            border: 1px solid rgb(171, 216, 191);


        }

        .navbar {

            overflow: hidden;
            position: fixed;
            bottom: 0;
            width: 100vw;
            height: 15vh;
        }
        a{
            color: #0b0b0b;
            text-decoration: none;
            font-size: 20px;
        }
    </style>
</head>

<body>
    <div id="board">
    </div>
    <div class="navbar">
        <strong> click to choose the color </strong>
        <div style="background-color:red;width:20px;height:20px;display:inline-block;border-radius:50%;"
            onclick="changeMainColor(1)"></div>
        <div style="background-color:green;width:20px;height:20px;display:inline-block;border-radius:50%;"
            onclick="changeMainColor(2)"></div>
        <div style="background-color:blue;width:20px;height:20px;display:inline-block;border-radius:50%;"
            onclick="changeMainColor(3)"></div>
        <div style="background-color:yellow;width:20px;height:20px;display:inline-block;border-radius:50%;"
            onclick="changeMainColor(4)"></div>
            <a href="https://abii.me/" target="_blank"><strong>Abi</strong></a>
    </div>
    

    <script>
        let isUpdating = false;
        let msg_ = 0;
        let mainColor = "red"
        let colors = [];
        const socket = new WebSocket('ws://localhost:8080');

        // Connection opened
        socket.addEventListener('open', function (event) {
            console.log('Connected to WS Server')

        });

        // Listen for messages
        socket.addEventListener('message', function (event) {
            console.log(typeof (message))
            if (msg_ != 0) {
                event.data.text().then(
                    (data) => {

                        let message = data.split(" ");
                        let id = message[0];
                        let color = message[1];
                        let div = document.querySelector(`[data-id="${id}"]`);
                        if (color == 1) {
                            div.style.backgroundColor = "red";
                        }
                        if (color == 2) {
                            div.style.backgroundColor = "green";
                        }
                        if (color == 3) {
                            div.style.backgroundColor = "blue";
                        }
                        if (color == 4) {
                            div.style.backgroundColor = "yellow";
                        }
                        msg_++;



                    }

                )

            }
            else {
                let values = event.data.split(",");
                for (let i = 0; i < values.length; i++) {
                    let div = document.querySelector(`[data-id="${i}"]`);
                    let color_index=parseInt(values[i]);
                    if (color_index == 1) {
                        div.style.backgroundColor = "red";
                    }
                    if (color_index == 2) {
                        div.style.backgroundColor = "green";
                    }
                    if (color_index == 3) {
                        div.style.backgroundColor = "blue";
                    }
                    if (color_index == 4) {
                        div.style.backgroundColor = "yellow";
                    }

             
                }
                msg_ = 1;

            }


        });

        const board = document.getElementById('board');
        for (let i = 0; i < 64 * 64; i++) {
            const div = document.createElement('div');
            div.dataset.id = i;
            board.appendChild(div);
        }
        const divs = document.querySelectorAll('#board div');
        divs.forEach(div => {
            div.addEventListener('mouseover', () => {
                div.style.backgroundColor = mainColor;
                if (mainColor == "red") {
                    colors[div.dataset.id] = 1;
                }
                if (mainColor == "green") {
                    colors[div.dataset.id] = 2;
                }
                if (mainColor == "blue") {
                    colors[div.dataset.id] = 3;
                }
                if (mainColor == "yellow") {
                    colors[div.dataset.id] = 4;
                }

                socket.send(div.dataset.id + " " + colors[div.dataset.id]);

            })
        });
        const changeMainColor = (val) => {
            if (val == 1) {
                mainColor = "red";
            }
            if (val == 2) {
                mainColor = "green";
            }
            if (val == 3) {
                mainColor = "blue";
            }
            if (val == 4) {
                mainColor = "yellow";
            }
        }


    </script>

</body>

</html>